autointent.modules
==================

.. py:module:: autointent.modules


Submodules
----------

.. toctree::
   :maxdepth: 1

   /autoapi/autointent/modules/prediction/index
   /autoapi/autointent/modules/retrieval/index
   /autoapi/autointent/modules/scoring/index


Attributes
----------

.. autoapisummary::

   autointent.modules.RETRIEVAL_MODULES_MULTICLASS
   autointent.modules.RETRIEVAL_MODULES_MULTILABEL
   autointent.modules.SCORING_MODULES_MULTICLASS
   autointent.modules.SCORING_MODULES_MULTILABEL
   autointent.modules.PREDICTION_MODULES_MULTICLASS
   autointent.modules.PREDICTION_MODULES_MULTILABEL


Classes
-------

.. autoapisummary::

   autointent.modules.Module
   autointent.modules.RegExp
   autointent.modules.AdaptivePredictor
   autointent.modules.ArgmaxPredictor
   autointent.modules.JinoosPredictor
   autointent.modules.PredictionModule
   autointent.modules.ThresholdPredictor
   autointent.modules.TunablePredictor
   autointent.modules.RetrievalModule
   autointent.modules.VectorDBModule
   autointent.modules.DescriptionScorer
   autointent.modules.DNNCScorer
   autointent.modules.KNNScorer
   autointent.modules.LinearScorer
   autointent.modules.MLKnnScorer
   autointent.modules.ScoringModule


Package Contents
----------------

.. py:class:: Module

   Bases: :py:obj:`abc.ABC`


   Base module.


   .. py:attribute:: name
      :type:  str


   .. py:attribute:: metadata_dict_name
      :type:  str
      :value: 'metadata.json'



   .. py:attribute:: metadata
      :type:  autointent.custom_types.BaseMetadataDict


   .. py:method:: fit(*args, **kwargs)
      :abstractmethod:


      Fit the model.

      :param args: Args to fit
      :param kwargs: Kwargs to fit



   .. py:method:: score(context, metric_fn)
      :abstractmethod:


      Calculate metric on test set and return metric value.

      :param context: Context to score
      :param metric_fn: Metric function



   .. py:method:: get_assets()
      :abstractmethod:


      Return useful assets that represent intermediate data into context.



   .. py:method:: clear_cache()
      :abstractmethod:


      Clear cache.



   .. py:method:: dump(path)
      :abstractmethod:


      Dump all data needed for inference.

      :param path: Path to dump



   .. py:method:: load(path)
      :abstractmethod:


      Load data from dump.

      :param path: Path to load



   .. py:method:: predict(*args, **kwargs)
      :abstractmethod:


      Predict on the input.

      :param args: args to predict.
      :param kwargs: kwargs to predict.



   .. py:method:: predict_with_metadata(*args, **kwargs)

      Predict on the input with metadata.

      :param args: args to predict.
      :param kwargs: kwargs to predict.



   .. py:method:: from_context(context, **kwargs)
      :classmethod:

      :abstractmethod:


      Initialize self from context.

      :param context: Context to init from.
      :param kwargs: Additional kwargs.



   .. py:method:: get_embedder_name()

      Experimental method.



.. py:class:: RegExp

   Bases: :py:obj:`autointent.modules._base.Module`


   Regular expressions based intent detection module.


   .. py:method:: from_context(context)
      :classmethod:


      Initialize from context.



   .. py:method:: fit(intents)

      Fit the model.

      :param intents: Intents to fit



   .. py:method:: predict(utterances)

      Predict intents for utterances.

      :param utterances: Utterances to predict



   .. py:method:: predict_with_metadata(utterances)

      Predict intents for utterances with metadata.

      :param utterances: Utterances to predict



   .. py:method:: score(context, metric_fn)

      Calculate metric on test set and return metric value.

      :param context: Context to score
      :param metric_fn: Metric function



   .. py:method:: clear_cache()

      Clear cache.



   .. py:method:: get_assets()

      Get assets.



   .. py:method:: load(path)

      Load data from dump.

      :param path: Path to load



   .. py:method:: dump(path)

      Dump all data needed for inference.

      :param path: Path to dump



.. py:class:: AdaptivePredictor(search_space = None)

   Bases: :py:obj:`autointent.modules.prediction._base.PredictionModule`


   Predictor for multi-label classification using adaptive thresholds.

   The AdaptivePredictor calculates optimal thresholds based on the given
   scores and labels, ensuring the best performance on multi-label data.

   :ivar metadata_dict_name: Filename for saving metadata to disk.
   :ivar n_classes: Number of classes in the dataset.
   :ivar _r: Scaling factor for thresholds.
   :ivar tags: List of Tag objects for mutually exclusive classes.
   :ivar name: Name of the predictor, defaults to "adaptive".


   .. py:attribute:: metadata_dict_name
      :value: 'metadata.json'



   .. py:attribute:: n_classes
      :type:  int


   .. py:attribute:: tags
      :type:  list[autointent.context.data_handler.Tag] | None


   .. py:attribute:: name
      :value: 'adaptive'



   .. py:attribute:: search_space


   .. py:method:: from_context(context, search_space = None)
      :classmethod:


      Create an AdaptivePredictor instance using a Context object.

      :param context: Context containing configurations and utilities.
      :param search_space: List of threshold scaling factors, or None for default.
      :return: Initialized AdaptivePredictor instance.



   .. py:method:: fit(scores, labels, tags = None)

      Fit the predictor by optimizing the threshold scaling factor.

      :param scores: Array of shape (n_samples, n_classes) with predicted scores.
      :param labels: List of true multi-label targets.
      :param tags: List of Tag objects for mutually exclusive classes, or None.
      :raises WrongClassificationError: If used on non-multi-label data.



   .. py:method:: predict(scores)

      Predict labels for the given scores.

      :param scores: Array of shape (n_samples, n_classes) with predicted scores.
      :return: Array of shape (n_samples, n_classes) with predicted binary labels.
      :raises InvalidNumClassesError: If the number of classes does not match the trained predictor.



   .. py:method:: dump(path)

      Save the predictor's metadata to disk.

      :param path: Path to the directory where metadata will be saved.



   .. py:method:: load(path)

      Load the predictor's metadata from disk.

      :param path: Path to the directory containing saved metadata.



.. py:class:: ArgmaxPredictor

   Bases: :py:obj:`autointent.modules.prediction._base.PredictionModule`


   Argmax prediction module.


   .. py:attribute:: name
      :value: 'argmax'



   .. py:attribute:: n_classes
      :type:  int


   .. py:method:: from_context(context)
      :classmethod:


      Initialize form context.

      :param context: Context



   .. py:method:: fit(scores, labels, tags = None)

      Argmax not fitting anything.

      :param scores: Scores to fit
      :param labels: Labels to fit
      :param tags: Tags to fit
      :raises WrongClassificationError: If the classification is wrong.



   .. py:method:: predict(scores)

      Predict the argmax.

      :param scores: Scores to predict
      :raises InvalidNumClassesError: If the number of classes is invalid.



   .. py:method:: dump(path)

      Dump.

      :param path: Dump path.



   .. py:method:: load(path)

      Load.



.. py:class:: JinoosPredictor(search_space = None)

   Bases: :py:obj:`autointent.modules.prediction._base.PredictionModule`


   Jinoos predictor module.


   .. py:attribute:: thresh
      :type:  float


   .. py:attribute:: name
      :value: 'jinoos'



   .. py:attribute:: n_classes
      :type:  int


   .. py:attribute:: search_space


   .. py:method:: from_context(context, search_space = None)
      :classmethod:


      Initialize from context.

      :param context: Context
      :param search_space: Search space



   .. py:method:: fit(scores, labels, tags = None)

      Fit the model.

      :param scores: Scores to fit
      :param labels: Labels to fit
      :param tags: Tags to fit



   .. py:method:: predict(scores)

      Predict the best score.

      :param scores: Scores to predict



   .. py:method:: dump(path)

      Dump all data needed for inference.

      :param path: Path to dump



   .. py:method:: load(path)

      Load data from dump.

      :param path: Path to load



   .. py:method:: jinoos_score(y_true, y_pred)
      :staticmethod:


      Calculate Jinoos score.

      .. math::

          \\frac{C_{in}}{N_{in}}+\\frac{C_{oos}}{N_{oos}}

      where $C_{in}$ is the number of correctly predicted in-domain labels
       and $N_{in}$ is the total number of in-domain labels. The same for OOS samples

      :param y_true: True labels
      :param y_pred: Predicted labels



.. py:class:: PredictionModule

   Bases: :py:obj:`autointent.modules.Module`, :py:obj:`abc.ABC`


   Base class for prediction modules.


   .. py:method:: fit(scores, labels, tags = None)
      :abstractmethod:


      Fit the model.

      :param scores: Scores to fit
      :param labels: Labels to fit
      :param tags: Tags to fit



   .. py:method:: predict(scores)
      :abstractmethod:


      Predict the best score.

      :param scores: Scores to predict



   .. py:method:: score(context, metric_fn)

      Calculate metric on test set and return metric value.

      :param context: Context to score
      :param metric_fn: Metric function
      :return: Score



   .. py:method:: get_assets()

      Return useful assets that represent intermediate data into context.



   .. py:method:: clear_cache()

      Clear cache.



.. py:class:: ThresholdPredictor(thresh)

   Bases: :py:obj:`autointent.modules.prediction._base.PredictionModule`


   Threshold predictor module.


   .. py:attribute:: metadata
      :type:  ThresholdPredictorDumpMetadata


   .. py:attribute:: multilabel
      :type:  bool


   .. py:attribute:: n_classes
      :type:  int


   .. py:attribute:: tags
      :type:  list[autointent.context.data_handler.Tag] | None


   .. py:attribute:: name
      :value: 'threshold'



   .. py:attribute:: thresh


   .. py:method:: from_context(context, thresh = 0.5)
      :classmethod:


      Initialize from context.

      :param context: Context
      :param thresh: Threshold



   .. py:method:: fit(scores, labels, tags = None)

      Fit the model.

      :param scores: Scores to fit
      :param labels: Labels to fit
      :param tags: Tags to fit



   .. py:method:: predict(scores)

      Predict the best score.

      :param scores: Scores to predict



   .. py:method:: dump(path)

      Dump the metadata.

      :param path: Path to dump



   .. py:method:: load(path)

      Load the metadata.

      :param path: Path to load



.. py:class:: TunablePredictor(n_trials = 320, seed = 0, tags = None)

   Bases: :py:obj:`autointent.modules.prediction._base.PredictionModule`


   Tunable predictor module.


   .. py:attribute:: name
      :value: 'tunable'



   .. py:attribute:: multilabel
      :type:  bool


   .. py:attribute:: n_classes
      :type:  int


   .. py:attribute:: tags
      :type:  list[autointent.context.data_handler.Tag] | None


   .. py:attribute:: n_trials


   .. py:attribute:: seed


   .. py:method:: from_context(context, n_trials = 320)
      :classmethod:


      Initialize from context.

      :param context: Context
      :param n_trials: Number of trials



   .. py:method:: fit(scores, labels, tags = None)

      Fit module.

      When data doesn't contain out-of-scope utterances, using TunablePredictor imposes unnecessary
       computational overhead.

      :param scores: Scores to fit
      :param labels: Labels to fit
      :param tags: Tags to fit



   .. py:method:: predict(scores)

      Predict the best score.

      :param scores: Scores to predict



   .. py:method:: dump(path)

      Dump all data needed for inference.

      :param path: Path to dump



   .. py:method:: load(path)

      Load data from dump.

      :param path: Path to load



.. py:class:: RetrievalModule(k)

   Bases: :py:obj:`autointent.modules.Module`, :py:obj:`abc.ABC`


   Base class for retrieval modules.


   .. py:attribute:: k


.. py:class:: VectorDBModule(k, embedder_name, db_dir = None, device = 'cpu', batch_size = 32, max_length = None)

   Bases: :py:obj:`autointent.modules.retrieval._base.RetrievalModule`


   Module for managing retrieval operations using a vector database.

   This class provides methods for indexing, querying, and managing a vector database for tasks
   such as nearest neighbor retrieval.


   .. py:attribute:: vector_index
      :type:  autointent.context.vector_index_client.VectorIndex


   .. py:attribute:: name
      :value: 'vector_db'



   .. py:attribute:: embedder_name


   .. py:attribute:: device


   .. py:attribute:: batch_size


   .. py:attribute:: max_length


   .. py:method:: from_context(context, k, embedder_name)
      :classmethod:


      Create a VectorDBModule instance using a Context object.

      :param context: The context containing configurations and utilities.
      :param k: Number of nearest neighbors to retrieve.
      :param embedder_name: Name of the embedder to use.
      :return: Initialized VectorDBModule instance.



   .. py:property:: db_dir
      :type: str


      Get the directory for the vector database.

      :return: Path to the database directory.



   .. py:method:: fit(utterances, labels)

      Fit the vector index using the provided utterances and labels.

      :param utterances: List of text data to index.
      :param labels: List of corresponding labels for the utterances.



   .. py:method:: score(context, metric_fn)

      Evaluate the retrieval model using a specified metric function.

      :param context: The context containing test data and labels.
      :param metric_fn: Function to compute the retrieval metric.
      :return: Computed metric score.



   .. py:method:: get_assets()

      Get the retriever artifacts for this module.

      :return: A RetrieverArtifact object containing embedder information.



   .. py:method:: clear_cache()

      Clear cached data in memory used by the vector index.



   .. py:method:: dump(path)

      Save the module's metadata and vector index to a specified directory.

      :param path: Path to the directory where assets will be dumped.



   .. py:method:: load(path)

      Load the module's metadata and vector index from a specified directory.

      :param path: Path to the directory containing the dumped assets.



   .. py:method:: predict(utterances)

      Predict the nearest neighbors for a list of utterances.

      :param utterances: List of utterances for which nearest neighbors are to be retrieved.
      :return: A tuple containing:
          - labels: List of retrieved labels for each utterance.
          - distances: List of distances to the nearest neighbors.
          - texts: List of retrieved text data corresponding to the neighbors.



.. py:class:: DescriptionScorer(embedder_name, temperature = 1.0, device = 'cpu', batch_size = 32, max_length = None)

   Bases: :py:obj:`autointent.modules.scoring.ScoringModule`


   Scoring module that scores utterances based on similarity to intent descriptions.


   .. py:attribute:: weights_file_name
      :type:  str
      :value: 'description_vectors.npy'



   .. py:attribute:: embedder
      :type:  autointent.Embedder


   .. py:attribute:: precomputed_embeddings
      :type:  bool
      :value: False



   .. py:attribute:: embedding_model_subdir
      :type:  str
      :value: 'embedding_model'



   .. py:attribute:: db_dir
      :type:  str


   .. py:attribute:: name
      :value: 'description'



   .. py:attribute:: temperature


   .. py:attribute:: device


   .. py:attribute:: embedder_name


   .. py:attribute:: batch_size


   .. py:attribute:: max_length


   .. py:method:: from_context(context, temperature, embedder_name = None)
      :classmethod:


      Create a DescriptionScorer instance using a Context object.

      :param context: Context containing configurations and utilities.
      :param temperature: Temperature parameter for scaling logits.
      :param embedder_name: Name of the embedder model. If None, the best embedder is used.
      :return: Initialized DescriptionScorer instance.



   .. py:method:: get_embedder_name()

      Get the name of the embedder.

      :return: Embedder name.



   .. py:method:: fit(utterances, labels, descriptions)

      Fit the scorer by embedding utterances and descriptions.

      :param utterances: List of utterances to embed.
      :param labels: List of labels corresponding to the utterances.
      :param descriptions: List of intent descriptions.
      :raises ValueError: If descriptions contain None values or embeddings mismatch utterances.



   .. py:method:: predict(utterances)

      Predict scores for utterances based on similarity to intent descriptions.

      :param utterances: List of utterances to score.
      :return: Array of probabilities for each utterance.



   .. py:method:: clear_cache()

      Clear cached data in memory used by the embedder.



   .. py:method:: dump(path)

      Save the scorer's metadata, description vectors, and embedder state.

      :param path: Path to the directory where assets will be dumped.



   .. py:method:: load(path)

      Load the scorer's metadata, description vectors, and embedder state.

      :param path: Path to the directory containing the dumped assets.



.. py:class:: DNNCScorer(cross_encoder_name, embedder_name, k, db_dir = None, device = 'cpu', train_head = False, batch_size = 32, max_length = None)

   Bases: :py:obj:`autointent.modules.scoring.ScoringModule`


   Scoring module for intent classification using a discriminative nearest neighbor classification (DNNC).

   This module uses a CrossEncoder for scoring candidate intents and can optionally
   train a logistic regression head on top of cross-encoder features.

   .. code-block:: bibtex

       @misc{zhang2020discriminativenearestneighborfewshot,
         title={Discriminative Nearest Neighbor Few-Shot Intent Detection by Transferring Natural Language Inference},
         author={Jian-Guo Zhang and Kazuma Hashimoto and Wenhao Liu and Chien-Sheng Wu and Yao Wan and
         Philip S. Yu and Richard Socher and Caiming Xiong},
         year={2020},
         eprint={2010.13009},
         archivePrefix={arXiv},
         primaryClass={cs.CL},
         url={https://arxiv.org/abs/2010.13009},
       }



   .. py:attribute:: name
      :value: 'dnnc'



   .. py:attribute:: crossencoder_subdir
      :type:  str
      :value: 'crossencoder'



   .. py:attribute:: model
      :type:  sentence_transformers.CrossEncoder | autointent.modules.scoring._dnnc.head_training.CrossEncoderWithLogreg


   .. py:attribute:: prebuilt_index
      :type:  bool
      :value: False



   .. py:attribute:: cross_encoder_name


   .. py:attribute:: embedder_name


   .. py:attribute:: k


   .. py:attribute:: train_head


   .. py:attribute:: device


   .. py:attribute:: batch_size


   .. py:attribute:: max_length


   .. py:property:: db_dir
      :type: str


      Get the database directory for the vector index.

      :return: Path to the database directory.



   .. py:method:: from_context(context, cross_encoder_name, k, embedder_name = None, train_head = False)
      :classmethod:


      Create a DNNCScorer instance using a Context object.

      :param context: Context containing configurations and utilities.
      :param cross_encoder_name: Name of the cross-encoder model.
      :param k: Number of nearest neighbors to retrieve.
      :param embedder_name: Name of the embedder model, or None to use the best embedder.
      :param train_head: Whether to train a logistic regression head, defaults to False.
      :return: Initialized DNNCScorer instance.



   .. py:method:: fit(utterances, labels)

      Fit the scorer by training or loading the vector index and optionally training a logistic regression head.

      :param utterances: List of training utterances.
      :param labels: List of labels corresponding to the utterances.
      :raises ValueError: If the vector index mismatches the provided utterances.



   .. py:method:: predict(utterances)

      Predict class scores for the given utterances.

      :param utterances: List of utterances to score.
      :return: Array of predicted scores.



   .. py:method:: predict_with_metadata(utterances)

      Predict class scores along with metadata for the given utterances.

      :param utterances: List of utterances to score.
      :return: Tuple of scores and metadata containing neighbor details and scores.



   .. py:method:: clear_cache()

      Clear cached data in memory used by the vector index.



   .. py:method:: dump(path)

      Save the DNNCScorer's metadata, vector index, and model to disk.

      :param path: Path to the directory where assets will be dumped.



   .. py:method:: load(path)

      Load the DNNCScorer's metadata, vector index, and model from disk.

      :param path: Path to the directory containing the dumped assets.



.. py:class:: KNNScorer(embedder_name, k, weights, db_dir = None, device = 'cpu', batch_size = 32, max_length = None)

   Bases: :py:obj:`autointent.modules.scoring.ScoringModule`


   K-nearest neighbors (KNN) scorer for intent classification.

   This module uses a vector index to retrieve nearest neighbors for query utterances
   and applies a weighting strategy to compute class probabilities.

   :ivar weights: Weighting strategy used for scoring.
   :ivar _vector_index: VectorIndex instance for neighbor retrieval.
   :ivar name: Name of the scorer, defaults to "knn".
   :ivar prebuilt_index: Flag indicating if the vector index is prebuilt.


   .. py:attribute:: weights
      :type:  autointent.custom_types.WEIGHT_TYPES


   .. py:attribute:: name
      :value: 'knn'



   .. py:attribute:: prebuilt_index
      :type:  bool
      :value: False



   .. py:attribute:: embedder_name


   .. py:attribute:: k


   .. py:attribute:: device


   .. py:attribute:: batch_size


   .. py:attribute:: max_length


   .. py:property:: db_dir
      :type: str


      Get the database directory for the vector index.

      :return: Path to the database directory.



   .. py:method:: from_context(context, k, weights, embedder_name = None)
      :classmethod:


      Create a KNNScorer instance using a Context object.

      :param context: Context containing configurations and utilities.
      :param k: Number of closest neighbors to consider during inference.
      :param weights: Weighting strategy for scoring.
      :param embedder_name: Name of the embedder, or None to use the best embedder.
      :return: Initialized KNNScorer instance.



   .. py:method:: get_embedder_name()

      Get the name of the embedder.

      :return: Embedder name.



   .. py:method:: fit(utterances, labels)

      Fit the scorer by training or loading the vector index.

      :param utterances: List of training utterances.
      :param labels: List of labels corresponding to the utterances.
      :raises ValueError: If the vector index mismatches the provided utterances.



   .. py:method:: predict(utterances)

      Predict class probabilities for the given utterances.

      :param utterances: List of query utterances.
      :return: Array of predicted probabilities for each class.



   .. py:method:: predict_with_metadata(utterances)

      Predict class probabilities along with metadata for the given utterances.

      :param utterances: List of query utterances.
      :return: Tuple of predicted probabilities and metadata with neighbor information.



   .. py:method:: clear_cache()

      Clear cached data in memory used by the vector index.



   .. py:method:: dump(path)

      Save the KNNScorer's metadata and vector index to disk.

      :param path: Path to the directory where assets will be dumped.



   .. py:method:: load(path)

      Load the KNNScorer's metadata and vector index from disk.

      :param path: Path to the directory containing the dumped assets.



.. py:class:: LinearScorer(embedder_name, cv = 3, n_jobs = -1, device = 'cpu', seed = 0, batch_size = 32, max_length = None)

   Bases: :py:obj:`autointent.modules.scoring._base.ScoringModule`


   Scoring module for linear classification using logistic regression.

   This module uses embeddings generated from a transformer model to train a
   logistic regression classifier for intent classification.

   :ivar classifier_file_name: Filename for saving the classifier to disk.
   :ivar embedding_model_subdir: Directory for saving the embedding model.
   :ivar precomputed_embeddings: Flag indicating if embeddings are precomputed.
   :ivar db_dir: Path to the database directory.
   :ivar name: Name of the scorer, defaults to "linear".


   .. py:attribute:: classifier_file_name
      :type:  str
      :value: 'classifier.joblib'



   .. py:attribute:: embedding_model_subdir
      :type:  str
      :value: 'embedding_model'



   .. py:attribute:: precomputed_embeddings
      :type:  bool
      :value: False



   .. py:attribute:: db_dir
      :type:  str


   .. py:attribute:: name
      :value: 'linear'



   .. py:attribute:: cv


   .. py:attribute:: n_jobs


   .. py:attribute:: device


   .. py:attribute:: seed


   .. py:attribute:: embedder_name


   .. py:attribute:: batch_size


   .. py:attribute:: max_length


   .. py:method:: from_context(context, embedder_name = None)
      :classmethod:


      Create a LinearScorer instance using a Context object.

      :param context: Context containing configurations and utilities.
      :param embedder_name: Name of the embedder, or None to use the best embedder.
      :return: Initialized LinearScorer instance.



   .. py:method:: get_embedder_name()

      Get the name of the embedder.

      :return: Embedder name.



   .. py:method:: fit(utterances, labels)

      Train the logistic regression classifier.

      :param utterances: List of training utterances.
      :param labels: List of labels corresponding to the utterances.
      :raises ValueError: If the vector index mismatches the provided utterances.



   .. py:method:: predict(utterances)

      Predict probabilities for the given utterances.

      :param utterances: List of query utterances.
      :return: Array of predicted probabilities for each class.



   .. py:method:: clear_cache()

      Clear cached data in memory used by the embedder.



   .. py:method:: dump(path)

      Save the LinearScorer's metadata, classifier, and embedder to disk.

      :param path: Path to the directory where assets will be dumped.



   .. py:method:: load(path)

      Load the LinearScorer's metadata, classifier, and embedder from disk.

      :param path: Path to the directory containing the dumped assets.



.. py:class:: MLKnnScorer(k, embedder_name, db_dir = None, s = 1.0, ignore_first_neighbours = 0, device = 'cpu', batch_size = 32, max_length = None)

   Bases: :py:obj:`autointent.modules.scoring.ScoringModule`


   Multi-label k-nearest neighbors (ML-KNN) scorer.

   This module implements ML-KNN, a multi-label classifier that computes probabilities
   based on the k-nearest neighbors of a query instance.

   :ivar arrays_filename: Filename for saving probabilities to disk.
   :ivar metadata: Metadata about the scorer's configuration.
   :ivar prebuilt_index: Flag indicating if the vector index is prebuilt.
   :ivar name: Name of the scorer, defaults to "mlknn".


   .. py:attribute:: arrays_filename
      :type:  str
      :value: 'probs.npz'



   .. py:attribute:: metadata
      :type:  MLKnnScorerDumpMetadata


   .. py:attribute:: prebuilt_index
      :type:  bool
      :value: False



   .. py:attribute:: name
      :value: 'mlknn'



   .. py:attribute:: k


   .. py:attribute:: embedder_name


   .. py:attribute:: s


   .. py:attribute:: ignore_first_neighbours


   .. py:attribute:: device


   .. py:attribute:: batch_size


   .. py:attribute:: max_length


   .. py:property:: db_dir
      :type: str


      Get the database directory for the vector index.

      :return: Path to the database directory.



   .. py:method:: from_context(context, k, s = 1.0, ignore_first_neighbours = 0, embedder_name = None)
      :classmethod:


      Create an MLKnnScorer instance using a Context object.

      :param context: Context containing configurations and utilities.
      :param k: Number of nearest neighbors to consider.
      :param s: Smoothing parameter for probability calculations, defaults to 1.0.
      :param ignore_first_neighbours: Number of closest neighbors to ignore, defaults to 0.
      :param embedder_name: Name of the embedder, or None to use the best embedder.
      :return: Initialized MLKnnScorer instance.



   .. py:method:: get_embedder_name()

      Get the name of the embedder.

      :return: Embedder name.



   .. py:method:: fit(utterances, labels)

      Fit the scorer by training or loading the vector index and calculating probabilities.

      :param utterances: List of training utterances.
      :param labels: List of multi-label targets for each utterance.
      :raises TypeError: If the labels are not multi-label.
      :raises ValueError: If the vector index mismatches the provided utterances.



   .. py:method:: predict_labels(utterances, thresh = 0.5)

      Predict labels for the given utterances.

      :param utterances: List of query utterances.
      :param thresh: Threshold for binary classification, defaults to 0.5.
      :return: Predicted labels as a binary array.



   .. py:method:: predict(utterances)

      Predict probabilities for the given utterances.

      :param utterances: List of query utterances.
      :return: Array of predicted probabilities for each class.



   .. py:method:: predict_with_metadata(utterances)

      Predict probabilities along with metadata for the given utterances.

      :param utterances: List of query utterances.
      :return: Tuple of probabilities and metadata with neighbor information.



   .. py:method:: clear_cache()

      Clear cached data in memory used by the vector index.



   .. py:method:: dump(path)

      Save the MLKnnScorer's metadata and probabilities to disk.

      :param path: Path to the directory where assets will be dumped.



   .. py:method:: load(path)

      Load the MLKnnScorer's metadata and probabilities from disk.

      :param path: Path to the directory containing the dumped assets.



.. py:class:: ScoringModule

   Bases: :py:obj:`autointent.modules.Module`, :py:obj:`abc.ABC`


   Abstract base class for scoring modules.

   Scoring modules predict scores for utterances and evaluate their performance
   using a scoring metric.


   .. py:method:: score(context, metric_fn)

      Evaluate the scorer on a test set and compute the specified metric.

      :param context: Context containing test set and other data.
      :param metric_fn: Function to compute the scoring metric.
      :return: Computed metric value for the test set.



   .. py:method:: get_assets()

      Retrieve assets generated during scoring.

      :return: ScorerArtifact containing test scores and out-of-scope (OOS) scores.



   .. py:method:: predict(utterances)
      :abstractmethod:


      Predict scores for a list of utterances.

      :param utterances: List of utterances to score.
      :return: Array of predicted scores.



   .. py:method:: predict_topk(utterances, k = 3)

      Predict the top-k most probable classes for each utterance.

      :param utterances: List of utterances to score.
      :param k: Number of top classes to return, defaults to 3.
      :return: Array of shape (n_samples, k) with indices of the top-k classes.



.. py:data:: RETRIEVAL_MODULES_MULTICLASS
   :type:  dict[str, type[_base.Module]]

.. py:data:: RETRIEVAL_MODULES_MULTILABEL

.. py:data:: SCORING_MODULES_MULTICLASS
   :type:  dict[str, type[scoring.ScoringModule]]

.. py:data:: SCORING_MODULES_MULTILABEL
   :type:  dict[str, type[scoring.ScoringModule]]

.. py:data:: PREDICTION_MODULES_MULTICLASS
   :type:  dict[str, type[_base.Module]]

.. py:data:: PREDICTION_MODULES_MULTILABEL
   :type:  dict[str, type[_base.Module]]

